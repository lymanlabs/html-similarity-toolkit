# HTML Similarity Toolkit

A multi-dimensional toolkit for analysing and mapping websites.  It compares HTML pages through three complementary lenses:

1. **Semantic Similarity** â€“ What does the page *say*?  Uses Voyage AI text embeddings + UMAP projection.  ( `embed_and_visualize.py` )
2. **Structural Similarity** â€“ How is the page *built*?  Analyses DOM/ CSS templates, forms, link patterns, etc.  ( `structural_similarity.py` )
3. **Visual Similarity** â€“ What does the page *look like*?  Renders screenshots with Playwright and embeds them with CLIP.  ( `visual_similarity.py` )

A fourth script (`compare_all_approaches.py`) stitches the outputs together to illustrate how the same pair of pages can appear close or far apart depending on the perspective.

---

## Why use it?

â€¢ **Content teams** â€“ detect duplicate/related pages, power smarter recommendations, or audit SEO content.

â€¢ **Scraping / migration** â€“ automatically classify page templates before a site move.

â€¢ **UX / QA** â€“ catch inconsistent visual patterns or regressions across large sites.

---

## Quick-Start

```bash
# 1 . Install deps
pip install -r requirements.txt

# Playwright browsers (needed for the visual pipeline)
playwright install chromium

# 2 . Set your Voyage AI key  ðŸ“œðŸ”‘
export VOYAGE_API_KEY="sk-..."

# 3 . Run one or all pipelines
python embed_and_visualize.py          # semantic
python structural_similarity.py        # structural
python visual_similarity.py            # visual (async, takes a bit longer)
python compare_all_approaches.py       # pretty comparison figure
```

Large artefacts (HTML, PNG, JSON) are stored with **Git LFS**.  Make sure you have it:

```bash
git lfs install   # one-time per machine
```

---

## Output files

| Script | Key output |
| ------ | ---------- |
| `embed_and_visualize.py` | `html_embeddings_visualization.png`, `storage.json` |
| `structural_similarity.py` | `structural_similarity_analysis.png`, `structural_analysis_results.json` |
| `visual_similarity.py` | `visual_similarity_analysis.png`, `visual_analysis_results.json`, screenshots/ |
| `compare_all_approaches.py` | `three_approaches_comparison.png` |

All plots are high-resolution and suitable for reports.

## Example: Combined Comparison
![Three Approaches to HTML Similarity: Semantic vs Structural vs Visual](three_approaches_comparison.png)

---

## Repository layout

```
.
â”œâ”€â”€ .gitattributes              # Git LFS configuration for large files
â”œâ”€â”€ README.md                   # Project overview and instructions
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ embed_and_visualize.py      # Semantic similarity pipeline
â”œâ”€â”€ structural_similarity.py    # Structural similarity pipeline
â”œâ”€â”€ visual_similarity.py        # Visual similarity pipeline
â”œâ”€â”€ compare_all_approaches.py   # Combined comparison visualization
â”œâ”€â”€ combined_similarity.py      # Additional semantic helper script
â”œâ”€â”€ compare_approaches.py       # Secondary comparison script
â”œâ”€â”€ embed_with_rate_limits.py   # Embedding with rate-limit handling
â”œâ”€â”€ incremental_embed.py        # Incremental embedding utility
â”œâ”€â”€ test.py                     # Test and validation scripts
â”œâ”€â”€ stub_module.bundle.js       # Bundled JS stub module
â”œâ”€â”€ sample_html/                # Sample HTML input files (Adidas example)
â”‚   â”œâ”€â”€ about.html
â”‚   â”œâ”€â”€ blog.html
â”‚   â”œâ”€â”€ contact.html
â”‚   â”œâ”€â”€ homepage.html
â”‚   â”œâ”€â”€ products.html
â”‚   â”œâ”€â”€ stan_pdp.html
â”‚   â”œâ”€â”€ stans.html
â”‚   â”œâ”€â”€ stans_men.html
â”‚   â”œâ”€â”€ stans_tan.html
â”‚   â””â”€â”€ stans_white.html
â”œâ”€â”€ screenshots/                # Screenshots generated by visual pipeline (tracked via LFS)
â”‚   â”œâ”€â”€ added_to_bag.html.png
â”‚   â”œâ”€â”€ cart.html.png
â”‚   â”œâ”€â”€ checkout.html.png
â”‚   â”œâ”€â”€ home.html.png
â”‚   â”œâ”€â”€ stan_pdp.html.png
â”‚   â”œâ”€â”€ stans.html.png
â”‚   â”œâ”€â”€ stans_men.html.png
â”‚   â”œâ”€â”€ stans_tan.html.png
â”‚   â””â”€â”€ stans_white.html.png
â”œâ”€â”€ *.png                       # Visualization outputs (tracked via LFS)
â”‚   â”œâ”€â”€ html_embeddings_visualization.png
â”‚   â”œâ”€â”€ combined_similarity_analysis.png
â”‚   â”œâ”€â”€ semantic_vs_structural_comparison.png
â”‚   â”œâ”€â”€ structural_similarity_analysis.png
â”‚   â”œâ”€â”€ three_approaches_comparison.png
â”‚   â””â”€â”€ visual_similarity_analysis.png
â”œâ”€â”€ *.json                      # Analysis result files (tracked via LFS)
â”‚   â”œâ”€â”€ storage.json
â”‚   â”œâ”€â”€ structural_analysis_results.json
â”‚   â””â”€â”€ visual_analysis_results.json
â””â”€â”€ semantic_mesh.html          # Example semantic mesh HTML output
```

---

## Extending

â€¢ **Bring your own pages** â€“ drop `.html` files into `sample_html/`.

â€¢ **Swap embedding models** â€“ change the `model=` param in the semantic script; CLIP variant for visuals, etc.

â€¢ **Plug-in extra signals** â€“ e.g. performance metrics, accessibility scores.

Contributions & suggestions welcome â€“ feel free to open an issue or PR!  

---

## Licence
MIT Â© Lyman Labs 